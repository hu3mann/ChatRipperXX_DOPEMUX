{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://xtractxact.dev/schemas/enrichment_cu.schema.json",
  "title": "Enrichment (Conversation Unit)",
  "type": "object",
  "additionalProperties": false,
  "required": ["cu_id", "topic_label", "vibe_trajectory", "escalation_curve", "ledgers", "evidence_index", "confidence_llm", "source", "provenance"],
  "properties": {
    "cu_id": {"type": "string"},
    "topic_label": {"type": "string", "maxLength": 64},
    "vibe_trajectory": {"type": "array", "items": {"type": "string"}},
    "escalation_curve": {"type": "string", "enum": ["low", "spike", "high", "resolve"]},
    "ledgers": {
      "type": "object",
      "additionalProperties": false,
      "required": ["boundary", "consent", "decisions", "commitments"],
      "properties": {
        "boundary": {"type": "array", "items": {"type": "string"}},
        "consent": {"type": "array", "items": {"type": "string"}},
        "decisions": {"type": "array", "items": {"type": "string"}},
        "commitments": {"type": "array", "items": {"type": "string"}}
      }
    },
    "issue_refs": {"type": "array", "items": {"type": "string"}},
    "coarse_labels": {"type": "array", "items": {"type": "string"}},
    "fine_labels_local": {"type": "array", "items": {"type": "string"}},
    "evidence_index": {"type": "array", "items": {"type": "string"}, "description": "Message IDs used as evidence."},
    "confidence_llm": {"type": "number", "minimum": 0, "maximum": 1},
    "source": {"type": "string", "enum": ["local", "cloud"]},
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_v", "run_id", "model_id", "prompt_hash"],
      "properties": {
        "schema_v": {"type": "string"},
        "run_id": {"type": "string"},
        "model_id": {"type": "string"},
        "prompt_hash": {"type": "string"}
      }
    },
    "shield": {"type": "object", "additionalProperties": true}
  }
}