{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://xtractxact.dev/schemas/chunk.schema.json",
  "title": "Chunk (LLM-ready, Redacted)",
  "type": "object",
  "additionalProperties": false,
  "required": ["chunk_id", "conv_id", "text", "meta", "provenance"],
  "properties": {
    "chunk_id": { "type": "string", "minLength": 1 },
    "conv_id": { "type": "string", "minLength": 1 },
    "text": { "type": "string", "minLength": 1, "description": "Redacted content only" },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["contact", "platform", "date_start", "date_end", "message_ids", "window"],
      "properties": {
        "contact": { "type": "string" },
        "platform": { "type": "string", "enum": ["imessage", "instagram", "whatsapp", "txt"] },
        "date_start": { "type": "string", "format": "date-time" },
        "date_end": { "type": "string", "format": "date-time" },
        "message_ids": { "type": "array", "items": { "type": "string" } },
        "labels_coarse": { "type": "array", "items": { "type": "string" } },
        "labels_fine_local": { "type": "array", "items": { "type": "string" } },
        "episode_ids": { "type": "array", "items": { "type": "string" } },
        "char_count": { "type": "integer", "minimum": 0 },
        "token_estimate": { "type": "integer", "minimum": 0 },
        "window": {
          "type": "object",
          "additionalProperties": false,
          "required": ["method", "index"],
          "properties": {
            "method": { "type": "string", "enum": ["turns", "daily", "semantic", "fixed"] },
            "index": { "type": "integer", "minimum": 0 },
            "overlap": { "type": "integer", "minimum": 0 }
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_v", "run_id", "source_hash"],
      "properties": {
        "schema_v": { "type": "string" },
        "run_id": { "type": "string" },
        "source_hash": { "type": "string" },
        "model_id": { "type": ["string", "null"] },
        "prompt_hash": { "type": ["string", "null"] }
      }
    }
  }
}
