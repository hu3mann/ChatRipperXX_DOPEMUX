Implement via tests-first:
1) Create/extend failing tests under tests/**.
2) Minimal diffs in src/**; cite any context7 lines used.
3) Run ruff, mypy, pytest; iterate until green.
4) Keep changes â‰¤200 lines; split if larger.
